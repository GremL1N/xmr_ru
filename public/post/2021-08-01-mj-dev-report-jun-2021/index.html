<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Отчёт mj за июнь по разработке и интеграциям - </title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Отчёт mj за июнь по разработке и интеграциям" />
<meta property="og:description" content="Уважаемое сообщество!
В прошлом месяце большую часть времени моя работа была сосредоточена на решении некоторых коварных проблем, связанных с CI. С одной стороны, я и @selsta убедились в том, что CI проверяет по крайней мере наиболее репрезентативные комбинации настроек сборки, а с другой стороны, я обнаружил, как часто наши кэши обрезаются из-за их совокупно большого размера, в результате чего появляется большое количество задач, а также неэффективно обработанных кэшей этих задач. Мне удалось внести соответствующие исправления и решить все эти проблемы." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/2021-08-01-mj-dev-report-jun-2021/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-08-01T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-08-01T00:00:00+00:00" />


		<meta itemprop="name" content="Отчёт mj за июнь по разработке и интеграциям">
<meta itemprop="description" content="Уважаемое сообщество!
В прошлом месяце большую часть времени моя работа была сосредоточена на решении некоторых коварных проблем, связанных с CI. С одной стороны, я и @selsta убедились в том, что CI проверяет по крайней мере наиболее репрезентативные комбинации настроек сборки, а с другой стороны, я обнаружил, как часто наши кэши обрезаются из-за их совокупно большого размера, в результате чего появляется большое количество задач, а также неэффективно обработанных кэшей этих задач. Мне удалось внести соответствующие исправления и решить все эти проблемы."><meta itemprop="datePublished" content="2021-08-01T00:00:00+00:00" />
<meta itemprop="dateModified" content="2021-08-01T00:00:00+00:00" />
<meta itemprop="wordCount" content="1223">
<meta itemprop="keywords" content="CCS," />
		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Отчёт mj за июнь по разработке и интеграциям"/>
<meta name="twitter:description" content="Уважаемое сообщество!
В прошлом месяце большую часть времени моя работа была сосредоточена на решении некоторых коварных проблем, связанных с CI. С одной стороны, я и @selsta убедились в том, что CI проверяет по крайней мере наиболее репрезентативные комбинации настроек сборки, а с другой стороны, я обнаружил, как часто наши кэши обрезаются из-за их совокупно большого размера, в результате чего появляется большое количество задач, а также неэффективно обработанных кэшей этих задач. Мне удалось внести соответствующие исправления и решить все эти проблемы."/>

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css">

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" rel="home">
			<div class="logo__item logo__imagebox">
					<img class="logo__img" src="/img/logo.png">
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Меню</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">Что такое Monero (XMR)?</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/news/">
				
				<span class="menu__text">Новости</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/articles/">
				
				<span class="menu__text">Статьи</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/library/">
				
				<span class="menu__text">Библиотека</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/manuals/">
				
				<span class="menu__text">Руководства и инструкции</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/services/">
				
				<span class="menu__text">Полезные ссылки и сервисы</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Отчёт mj за июнь по разработке и интеграциям</h1>
			<p class="post__lead">Ежемесячный отчёт mj в ключе работы над его CCS предложением.</p>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2021-08-01T00:00:00Z">2021-08-01</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/%D0%BD%D0%BE%D0%B2%D0%BE%D1%81%D1%82%D0%B8/" rel="category">Новости</a>
	</span>
</div></div>
		</header>
		<div class="content post__content clearfix">
			<p>Уважаемое сообщество!</p>
<p>В прошлом месяце большую часть времени моя работа была сосредоточена на решении некоторых коварных проблем, связанных с CI. С одной стороны, я и @selsta убедились в том, что CI проверяет по крайней мере наиболее репрезентативные комбинации настроек сборки, а с другой стороны, я обнаружил, как часто наши кэши обрезаются из-за их совокупно большого размера, в результате чего появляется большое количество задач, а также неэффективно обработанных кэшей этих задач. Мне удалось внести соответствующие исправления и решить все эти проблемы. Поскольку кэши более не будут обрезаться так часто, скоро мы станем свидетелями более быстрой проверки CI непосредственно с первого коммита (после слияния соответствующей ветки, конечно же). Мне также удалось исправить распространённую ошибку ccache под FreeBSD, хотя изначально я не был уверен, в чём именно была причина.</p>
<p>Также я постепенно переношу свой отчёт на другой хост, который, надеюсь, будет менее ограничительным с точки зрения читателей по всему земному шару. Изначально отчёт размещался здесь: <a href="http://enjo.hopto.org/pub/monero/,">http://enjo.hopto.org/pub/monero/,</a> и теперь я перемещаю его на этот адрес: <a href="http://cryptog.hopto.org/monero/health/">http://cryptog.hopto.org/monero/health/</a></p>
<p>Пожалуйста, дайте мне знать, если у вас не получается получить доступ к какому-либо из них. Если нет, то к какому именно?</p>
<p>Мною был составлен новый подотчёт под названием Headers (Заголовки). Это самостоятельно разработанный, не содержащий зависимостей инструмент для статической проверки зависимостей заголовков, позволяющий приблизительно за несколько секунд проделать работу, выполняемую Clang Build Analyzer, то есть, ему не требуется для этого целого часа, необходимого CBA. Как только инструмент достигнет состояния готовности, он станет удобным и быстрым средством, которым смогут пользоваться абсолютно все, подобно отчёту LCOV. А пока я просто размещаю здесь <a href="http://cryptog.hopto.org/monero/health/data/56f760964/56f760964-headers-result.txt">версию для предварительного просмотра</a>, где в самом верху вы можете увидеть обычного подозреваемого, wallet2.h :)</p>
<h2 id="_ветки_"><em>Ветки</em></h2>
<p>Вот традиционный список объединённых и вновь открытых веток:</p>
<p><em>Новые ветки</em></p>
<ul>
<li>CI: <a href="https://github.com/monero-project/monero/pull/7780">зависимый кэш (статический), отделённый от ccache (изменяемого)</a>. Я обнаружил, что каждая из многоплатформенных сборок хранит статический предварительно созданный файл вместе с изменяемыми файлами ccache. Поскольку практически в каждой новой ветке появляются некоторые изменения в файлах ccache, должен создаваться и новый архив кэша, который также включал бы и статические файлы, по сути, дублируя их без какой-либо причины. Это, наконец, привело к тому, что GitHub стал обрезать наши кэши в каждой 3-4-й ветке, что заставило CI начать кэширование заново. Я разделил эти кэши на 3 категории: изменяемые (ccache), в основном статические (тулчейны) и полностью статические (OSX SDK), тем самым увеличив время жизни кэшей примерно в 3 раза.</li>
<li>CI: <a href="https://github.com/monero-project/monero/pull/7787">Ubuntu-Test повторно использует кэш Ubuntu-Build и создает статические библиотеки</a>. Не было бы никаких причин для повторной сборки версии Ubuntu для тестов, если бы она строилась в качестве предварительного условия. В этом случае моя ошибка ранее заключалась в том, что я настаивал на динамической связи тестовой сборки, что означает появление отличной (и несовместимой) от только что созданной версии. Во-вторых, ошибка заключалась в тестировании чего бы то ни было в конфигурации, отличной от той, которую получает конечный пользователь (речь идёт о динамическом и статическом связывании, соответственно). Вместе с @selsta мы пришли к выводу, что лучше будет локально протестировать крайние случаи системы сборки. Также, поскольку, как вы только что прочитали в предыдущем пункте, мы уже достигли ограничения размера кэша, нам пришлось поддерживать показательный минимум количества заданий. Такое изменение позволяет сэкономить около получаса лишнего времени сборки.</li>
<li>CI: <a href="https://github.com/monero-project/monero/pull/7797">CCache во FreeBSD работает</a>. Как уже упоминалось, я заставил CCache работать, проведя тщательный анализ выдачи ошибочных команд. Выяснилось, что ccache под FreeBSD не работает, потому что двоичный файл ccache ожидает двоичный файл компилятора в качестве входящего, в то время как в случае FreeBSD он загружался с помощью сценария, предназначенного для конфигурирования двоичного файла компилятора за один раз. В данном случае работа состояла в том, чтобы разделить сценарий на часть, относящуюся к компилятору, и часть, связанную с конфигурацией. Чтобы сделать решение более устойчивым относительно изменений, вносимых в рамках будущих версии, сегментация производится автоматически с использованием Regex в файле CMake.</li>
<li>Doxygen: <a href="https://github.com/monero-project/monero/pull/7804">Исключение директорий сборки</a>. Файл конфигурации Doxygen в корневой исходной директории конфигурирован для разбиения всех репозиториев в течение некоторого времени. Тем не менее, это оставило нерешённой проблему сканирования не только очевидной директории сборки, но также и не столь очевидной директории contrib/depends, куда попадают все неинтересные файлы зависимостей, что может даже привести к сбою Doxygen, когда директория будет полностью заполнена различными многоплатформенными тулчейнами.</li>
<li>utils/health: <a href="https://github.com/monero-project/monero/pull/7806">Добавление инструментов покрытия строк</a>. Наконец, сценарий LCOV, который я использую для генерирования моих автоматических отчётов, теперь имеет качество, соответствующее полной готовности (читай: может быть правильно конфигурирован вызывающей стороной). Это означает, что теперь каждый желающий получить быстрое подтверждение, если предлагаемые им изменения имеют положительный эффект по охвату, или же если только что написанные тесты затрагивают крайние случаи, которые должны быть затронуты, получит его. Ветка содержит подробно задокументированный пример сценария, подготовленный специально для реализации процесса разработки через тестирование. Это изменение в целом в совокупности с двумя другими подразумевает <a href="https://github.com/monero-project/monero/pull/6937">отсутствие повторного связывания с изменением в реализации</a>, а <a href="https://github.com/monero-project/monero/pull/7416">динамическое связывание Epee</a> является последним оправданием для написания хороших модульных тестов ;)</li>
<li>utils / health: <a href="https://github.com/monero-project/monero/pull/7808">Разделение тестов Clang Tidy для C и C ++</a>. Простая публикация небольшого, но важного локального изменения, сделанного мною и используемого для моих отчётов по двум основным причинам: во-первых, наличие ошибок одного сканирования, не влияющих на второе, и, во-вторых, возможность запускать оба сканирования параллельно.</li>
</ul>
<p><em>Незначительные изменения</em></p>
<ul>
<li>Зависимости: <a href="https://github.com/monero-project/monero/pull/7779">сценарий mingw32-update-gcc-posix.sh</a>. Просто извлечение важного фрагмента кода из рабочих процессов GH, так как код также полезен и локально. Здесь также применяется некоторое сокращение дублирования. Также предоставлена документация.</li>
<li>Док: <a href="https://github.com/monero-project/monero/pull/7772">обновление статистики блокчейна комментариями</a>. Просто обновил документацию другого человека, сопроводив её аналитическими комментариями. У этого человека не было доступа к внесению записей в репозиторий Monero, поэтому был использован такой способ «пост-априорного» обновления, позволивший избежать проблем, связанных со слиянием с исходной веткой.</li>
</ul>
<p><em>Объединённые ветки</em></p>
<ul>
<li>EasyLogging ++: <a href="https://github.com/monero-project/monero/pull/7771">Добавление UTests, служащих защитой от регрессий</a>. Добавлены 2 теста, которые подтвердили валидность недавнего исправления ошибки сегментации в EasyLogging ++, сделанного moneromoo, и защитили его от регрессии. Эта ветка является одной из причин, по которой покрытие кода подскочило на 10%. Я не могу сказать наверняка, единственная это причина или нет.</li>
<li>CI: <a href="https://github.com/monero-project/monero/pull/7769">Обратная совместимость теста ubuntu 18.04</a>. Расширение обратной совместимости с Ubuntu 18.04 с использованием пакетов, используемых по умолчанию для версии Ubuntu по результатам обсуждения проблемы с @selsta. С помощью рабочих процессов Matrix была достигнута возможность многократного повторного использования кода (процесс также известный как параметризация)</li>
</ul>
<p><em>Закрытые (не объединённые) ветки</em></p>
<ul>
<li>Mac: <a href="https://github.com/monero-project/monero/pull/7775">Исправление динамической привязки в устройстве</a>. Мой приятель @TimSycamore захотел предоставить патч для исправления ошибок в динамической привязке Mac OSX, но позже выяснилось, что этот запрос уже был заменён более крупным PR, но при этом всё ещё находился в состоянии открытого запроса.</li>
<li>CI: <a href="https://github.com/monero-project/monero/pull/7770">Тестирование последней версии Boost под Ubuntu</a>. В июле был момент, когда вышла новая версия Boost, но компиляция этой новой версии завершилась неудачно. На тот момент у меня было острое желание обеспечить возможность обнаружения подобных ошибок заранее, но позже мы решили просто ограничить количество выполняемых заданий, полагаться на конкретные PR, касающиеся исправления крайних случаев, а не на их автоматическую проверку. Кроме того, позже в этом же месяце система управления пакетами Mac OSX Brew стала автоматически выдавать последнюю версию Boost, что сделало мои изменения устаревшими.</li>
<li>CI: <a href="https://github.com/monero-project/monero/pull/7768">Матрица версии Boost для build-ubuntu</a>. В данном случае я хотел проверить не только последнюю совместимую версию, но и самую младшую совместимую версию, и пришёл к интересным выводам, которые можно найти в описании ветки. Вкратце: самая младшая версия Boost, официально декларируемая как самая младшая совместимая версия для сборки Monero, слишком стара для создания библиотек OpenSSL, которые содержат важное исправление безопасности, вышедшее где-то в начале года. По вышеуказанным причинам мы решили закрыть ветку.</li>
</ul>
<p>Спасибо, что прочитали мой отчёт, и за вашу непрерывную поддержку!
mj</p>
<hr>
<p><em>Источник: <a href="https://www.reddit.com/r/Monero/comments/ovtxwf/dev_report_june_2021/">Dev report June 2021</a></em></p>
<p><em>Перевод: <a href="https://t.me/v1docq47">Mr. Pickles</a></em><br>
<em>Коррекция: <a href="https://t.me/Kukima">Kukima</a></em></p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/ccs/" rel="tag">CCS</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/post/2021-07-27-decoy-selection-algorithm-ignores-very-recent-outputs/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Назад</span>
			<p class="pager__title">Алгоритм выбора приманки в Monero игнорирует последние выходные данные (Issue #7807)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/post/2021-08-03-former-monero-maintainer-fluffypony-arrested-and-to-be-extradited-for-non-crypto-crimes/" rel="next">
			<span class="pager__subtitle">Вперед&thinsp;»</span>
			<p class="pager__title">Бывший мейнтейнер Monero Fluffypony арестован за преступления, не связанные с криптовалютой Monero</p>
		</a>
	</div>
</nav>


			</div>
			<aside class="sidebar">
<div class="widget-recent widget">
	<h4 class="widget__title">Недавние публикации</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/post/2021-12-06-vulnerability-multisig/">В коде multisig-кошелька Monero обнаружена ошибка</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/2021-12-04-monero-gui-0.17.3.0-released/">Доработанная версия Monero GUI 0.17.3.0 Oxygen Orion</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/2021-12-04-monero-0.17.3.0-released/">Доработанная промежуточная версия Monero 0.17.3.0 Oxygen Orion</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/2021-11-19-kraken-delist-monero-for-uk-customers/">Kraken планирует исключить Monero из списка поддерживаемых в Великобритании валют уже к концу ноября</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/2021-11-05-p2pool-1.3.1-released/">Релиз P2Pool v1.3.1</a></li>
		</ul>
	</div>
</div>
<div class="widget-taglist widget">
	<h4 class="widget__title">Теги</h4>
	<div class="widget__content">
		<a class="widget-taglist__link widget__link btn" href="/tags/breaking-monero/" title="Breaking Monero">Breaking Monero</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cake-wallet/" title="Cake Wallet">Cake Wallet</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/ccs/" title="CCS">CCS</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/cdc-36c3/" title="CDC 36c3">CDC 36c3</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/ciphertrace/" title="CipherTrace">CipherTrace</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/def-con-2021/" title="DEF CON 2021">DEF CON 2021</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/farcaster/" title="Farcaster">Farcaster</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/feather-wallet/" title="Feather Wallet">Feather Wallet</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/haveno/" title="Haveno">Haveno</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/konferenco/" title="Konferenco">Konferenco</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/monero-gui/" title="Monero GUI">Monero GUI</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/monero-outreach/" title="Monero Outreach">Monero Outreach</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/monerujo/" title="Monerujo">Monerujo</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/mpwg/" title="MPWG">MPWG</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/p2pool/" title="P2Pool">P2Pool</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/%D0%B0%D1%82%D0%BE%D0%BC%D0%B0%D1%80%D0%BD%D1%8B%D0%B5-%D1%81%D0%B2%D0%BE%D0%BF%D1%8B/" title="Атомарные свопы">Атомарные свопы</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/%D0%B2%D0%B7%D0%BB%D0%BE%D0%BC/" title="Взлом">Взлом</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/%D0%B2%D0%B8%D1%80%D1%83%D1%81/" title="Вирус">Вирус</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/%D0%B6%D1%83%D1%80%D0%BD%D0%B0%D0%BB-%D0%B2%D1%81%D1%82%D1%80%D0%B5%D1%87%D0%B8/" title="Журнал встречи">Журнал встречи</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/%D0%BD%D0%B0%D1%83%D1%87%D0%BD%D0%BE-%D1%84%D0%B0%D0%BD%D1%82%D0%B0%D1%81%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9-%D1%80%D0%B0%D1%81%D1%81%D0%BA%D0%B0%D0%B7/" title="Научно-фантастический рассказ">Научно-фантастический рассказ</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/%D0%BE%D1%88%D0%B8%D0%B1%D0%BA%D0%B0/" title="Ошибка">Ошибка</a>
	</div>
</div>
</aside>
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2021 .
			<span class="footer__copyright-credits">Информационно-новостной сайт русскоязычного сообщества Monero. <a href="/services/#_поддержать-xmrru_" rel="nofollow noopener" target="_blank">Пожертвовать</a>  на развитие проекта XMR.RU.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
<script src="/js/custom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>